<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muttermilch</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            padding: 30px 20px;
            text-align: center;
        }

        h1 {
            color: white;
            font-size: 24px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .info-icon {
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #20bf6b 0%, #01a3a4 100%);
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
            font-weight: bold;
        }

        .info-icon:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .breast-buttons {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
        }

        .breast-btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .breast-btn.left {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .breast-btn.right {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .breast-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .breast-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .breast-btn.active {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255,255,255,0); }
            100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); }
        }

        .timeline {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: white;
        }

        .timeline h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .last-breast-info {
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 15px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .last-breast-info.left {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .last-breast-info.right {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .current-session {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        /* Neue Klassen f√ºr die Brust-spezifischen Farben im Live-Feld */
        .current-session.left-breast {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .current-session.right-breast {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .current-session-time {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .day-summary {
            background: linear-gradient(135deg, #20bf6b 0%, #01a3a4 100%);
            color: white;
            padding: 12px 15px;
            border-radius: 10px;
            margin: 20px 0 15px 0;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .day-summary-date {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .day-summary-stats {
            font-size: 12px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .session-entry {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .session-entry:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateX(5px);
        }

        .session-entry.right-breast {
            border-left-color: #f093fb;
        }

        .session-entry.both-breasts {
            border-left-color: #20bf6b;
        }

        .session-date {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .session-time {
            color: #666;
            font-size: 13px;
            margin-top: 5px;
        }

        .session-duration {
            color: #28a745;
            font-weight: 600;
            font-size: 14px;
            margin-top: 5px;
        }

        .baby-section {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .baby-controls {
            margin-bottom: 15px;
        }

        .baby-select-row {
            display: flex;
            margin-bottom: 10px;
        }

        .baby-buttons-row {
            display: flex;
            gap: 10px;
            align-items: stretch;
            flex-wrap: wrap;
        }

        .baby-btn, .rename-baby-btn, .baby-delete-btn {
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .baby-btn, .rename-baby-btn {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .baby-btn:hover, .rename-baby-btn:hover, .baby-delete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        .baby-delete-btn {
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
        }

        .baby-select {
            width: 100%;
            padding: 0 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            height: 44px;
            box-sizing: border-box;
        }

        .export-import-controls {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }

        .export-import-left {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .export-btn, .import-btn {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        .export-btn:hover, .import-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .data-delete-btn {
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        .data-delete-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .file-input {
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            min-width: 300px;
            max-width: 90%;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 20px;
        }

        .readme-modal {
            max-height: 80vh;
            overflow-y: auto;
        }

        .readme-content {
            line-height: 1.6;
            color: #333;
        }

        .readme-content h2 {
            color: #667eea;
            margin: 20px 0 10px 0;
            font-size: 18px;
        }

        .readme-content h3 {
            color: #555;
            margin: 15px 0 8px 0;
            font-size: 16px;
        }

        .readme-content p {
            margin-bottom: 12px;
        }

        .readme-content ul {
            margin: 10px 0 10px 20px;
        }

        .readme-content li {
            margin-bottom: 8px;
        }

        .readme-content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .readme-content .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .session-modal .modal-content {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .single-session-edit {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .single-session-header {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .single-session-delete {
            text-align: left;
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Muttermilch <span class="info-icon" onclick="showReadme()">i</span></h1>
        </div>

        <div class="breast-buttons">
            <button class="breast-btn left" id="leftBreastBtn" onclick="toggleBreastfeeding('left')">
                Linke Brust
            </button>
            <button class="breast-btn right" id="rightBreastBtn" onclick="toggleBreastfeeding('right')">
                Rechte Brust
            </button>
        </div>

        <div class="timeline">
            <div id="currentSession"></div>
            <h3>Stillverlauf</h3>
            <div id="sessionsList">
                <div class="empty-state">
                    Noch keine Stillzeiten erfasst
                </div>
            </div>
        </div>

        <div class="baby-section">
            <div class="baby-controls">
                <div class="baby-select-row">
                    <select class="baby-select" id="babySelect" onchange="switchBaby()">
                        <option value="Baby">Baby</option>
                    </select>
                </div>
                <div class="baby-buttons-row">
                    <button class="rename-baby-btn" onclick="openRenameBabyModal()">Umbenennen</button>
                    <button class="baby-btn" onclick="openBabyModal()">Neues Baby</button>
                    <button class="baby-delete-btn" onclick="confirmDeleteBaby()">üóëÔ∏è Baby l√∂schen</button>
                </div>
            </div>
            <div class="export-import-controls">
                <div class="export-import-left">
                    <button class="export-btn" onclick="exportToCSV()">üì§ CSV Export</button>
                    <button class="import-btn" onclick="document.getElementById('csvFileInput').click()">üì• CSV Import</button>
                    <input type="file" id="csvFileInput" class="file-input" accept=".csv,.CSV,.txt,text/csv,text/plain,application/csv,application/excel" onchange="importFromCSV(event)">
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="babyModal">
        <div class="modal-content">
            <div class="modal-title">Neues Baby hinzuf√ºgen</div>
            <div class="form-group">
                <label>Name des Babys:</label>
                <input type="text" id="babyNameInput" placeholder="z.B. Emma">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeBabyModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="addBaby()">Hinzuf√ºgen</button>
            </div>
        </div>
    </div>

    <div class="modal" id="renameBabyModal">
        <div class="modal-content">
            <div class="modal-title">Baby umbenennen</div>
            <div class="form-group">
                <label>Neuer Name f√ºr "<span id="currentBabyName"></span>":</label>
                <input type="text" id="newBabyNameInput" placeholder="Neuer Name">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeRenameBabyModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="renameBaby()">Umbenennen</button>
            </div>
        </div>
    </div>

    <div class="modal" id="deleteConfirmModal">
        <div class="modal-content">
            <div class="modal-title">Baby l√∂schen</div>
            <p>M√∂chten Sie wirklich das Baby "<span id="deleteBabyName"></span>" und alle dazugeh√∂rigen Stillzeiten l√∂schen?</p>
            <p style="color: #d63031; font-weight: 600; margin-top: 15px;">‚ö†Ô∏è Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeDeleteConfirmModal()">Abbrechen</button>
                <button class="btn" style="background: #d63031; color: white;" onclick="deleteBaby()">L√∂schen</button>
            </div>
        </div>
    </div>

    <div class="modal session-modal" id="sessionModal">
        <div class="modal-content">
            <div class="modal-title">Stillzeiten bearbeiten</div>
            <div id="sessionEditContent">
                <!-- Wird dynamisch gef√ºllt -->
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeSessionModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="saveSessionChanges()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Allgemeine Nachrichtenmodals -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <div class="modal-title">‚ùå Fehler</div>
            <p id="errorMessage">Fehlermeldung</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closeErrorModal()">OK</button>
            </div>
        </div>
    </div>

    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-title">‚úÖ Erfolgreich</div>
            <p id="successMessage">Erfolgsmeldung</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closeSuccessModal()">OK</button>
            </div>
        </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-title">‚ùì Best√§tigung</div>
            <p id="confirmMessage">Best√§tigungsnachricht</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">Abbrechen</button>
                <button class="btn btn-primary" id="confirmButton" onclick="">Best√§tigen</button>
            </div>
        </div>
    </div>

    <div class="modal" id="deleteSessionModal">
        <div class="modal-content">
            <div class="modal-title">Stillzeit l√∂schen</div>
            <p>M√∂chten Sie diese Stillzeit wirklich l√∂schen?</p>
            <p style="color: #d63031; font-weight: 600; margin-top: 15px;">‚ö†Ô∏è Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeDeleteSessionModal()">Abbrechen</button>
                <button class="btn" style="background: #d63031; color: white;" id="deleteSessionButton">L√∂schen</button>
            </div>
        </div>
    </div>

    <div class="modal" id="readmeModal">
        <div class="modal-content readme-modal">
            <div class="modal-title">Muttermilch - Stillzeit Tracker</div>
            <div class="readme-content">
                <h2>üì± Was ist Muttermilch?</h2>
                <p>Muttermilch ist eine <strong>kostenlose, webbasierte App</strong> zum Tracken von Stillzeiten. Die App hilft Eltern dabei, den √úberblick √ºber Stillgewohnheiten ihres Babys zu behalten und wichtige Muster zu erkennen.</p>

                <h2>üîí Datenschutz & Privatsph√§re</h2>
                <p><span class="highlight">Ihre Daten bleiben 100% privat!</span></p>
                <ul>
                    <li><strong>Lokale Speicherung:</strong> Alle Daten werden nur auf Ihrem Ger√§t gespeichert</li>
                    <li><strong>Keine √úbertragung:</strong> Es werden keine Daten an den Entwickler oder Dritte gesendet</li>
                    <li><strong>Keine Registrierung:</strong> Kein Account oder pers√∂nliche Daten erforderlich</li>
                </ul>

                <h2>‚ö†Ô∏è Wichtiger Hinweis zu Datensicherheit</h2>
                <p><strong>Ihre Daten k√∂nnen verloren gehen wenn:</strong></p>
                <ul>
                    <li>Browser-Daten gel√∂scht werden</li>
                    <li>Browser-Cache geleert wird</li>
                    <li>Ger√§t zur√ºckgesetzt wird</li>
                </ul>
                <p><span class="highlight">Empfehlung:</span> Erstellen Sie regelm√§√üig ein Backup mit dem CSV-Export!</p>

                <h2>üíæ Backup & Daten√ºbertragung</h2>
                <h3>Backup erstellen:</h3>
                <ul>
                    <li>Klicken Sie auf <code>üì§ CSV Export</code></li>
                    <li>Speichern Sie die Datei an einem sicheren Ort</li>
                    <li>Bei Bedarf mit <code>üì• CSV Import</code> wiederherstellen</li>
                </ul>

                <h3>Daten zwischen Ger√§ten √ºbertragen:</h3>
                <ol>
                    <li>Auf dem alten Ger√§t: CSV exportieren</li>
                    <li>Datei auf das neue Ger√§t √ºbertragen</li>
                    <li>Auf dem neuen Ger√§t: CSV importieren</li>
                </ol>

                <h2>‚úèÔ∏è Handschriftliche Daten importieren</h2>
                <p>Sie k√∂nnen auch handschriftlich erfasste Stillzeiten nachtr√§glich importieren:</p>

                <h3>Schritt 1: CSV-Datei erstellen</h3>
                <p>Erstellen Sie eine Textdatei mit der Endung <code>.CSV</code> (z.B. <code>meine_daten.CSV</code>)</p>

                <h3>Schritt 2: Daten im CSV-Format eingeben</h3>
                <div class="code-block">"Baby","Brust","Startdatum","Startzeit","Enddatum","Endzeit","Dauer (Minuten)"
"Emma","Links","04.06.2025","08:00","04.06.2025","08:15","15"
"Emma","Rechts","04.06.2025","08:17","04.06.2025","08:30","13"
"Emma","Links","04.06.2025","11:30","04.06.2025","11:45","15"</div>

                <h3>Wichtige Format-Regeln:</h3>
                <ul>
                    <li><strong>Brust:</strong> "Links" oder "Rechts"</li>
                    <li><strong>Datum:</strong> TT.MM.JJJJ (z.B. 04.06.2025)</li>
                    <li><strong>Zeit:</strong> HH:MM (z.B. 08:00)</li>
                    <li><strong>Dauer:</strong> Optional - wird automatisch berechnet wenn nicht angegeben</li>
                    <li><strong>Anf√ºhrungszeichen:</strong> Jedes Feld in " " setzen</li>
                    <li><strong>Trennung:</strong> Felder mit Komma trennen</li>
                </ul>

                <h3>Schritt 3: Datei importieren</h3>
                <p>Klicken Sie auf <code>üì• CSV Import</code> und w√§hlen Sie Ihre Datei aus.</p>

                <h2>‚úèÔ∏è Daten bearbeiten & korrigieren</h2>
                <h3>Direkt in der App bearbeiten:</h3>
                <ul>
                    <li><strong>Stillzeiten anpassen:</strong> Klicken Sie auf eine Session im Stillverlauf</li>
                    <li><strong>Einzelne Sessions:</strong> √Ñndern Sie Baby, Brust, Start- und Endzeit</li>
                    <li><strong>Kombinierte Sessions:</strong> Bearbeiten Sie jede Einzelphase separat</li>
                    <li><strong>L√∂schen:</strong> Entfernen Sie versehentlich erfasste Sessions</li>
                    <li><strong>Baby-Management:</strong> Babys umbenennen oder l√∂schen</li>
                </ul>

                <h3>CSV-Daten extern bearbeiten:</h3>
                <ol>
                    <li>Daten mit <code>üì§ CSV Export</code> exportieren</li>
                    <li>CSV-Datei mit Texteditor √∂ffnen (z.B. Notepad, TextEdit)</li>
                    <li>Daten nach Bedarf √§ndern (Format beachten!)</li>
                    <li>Aktuelle App-Daten l√∂schen</li>
                    <li>Bearbeitete Datei mit <code>üì• CSV Import</code> reimportieren</li>
                </ol>

                <p><span class="highlight">Tipp:</span> F√ºr gr√∂√üere Korrekturen ist die externe Bearbeitung oft schneller!</p>

                <h2>üéØ Funktionen</h2>
                <ul>
                    <li><strong>Live-Timer:</strong> Echtzeiterfassung der Stillzeiten</li>
                    <li><strong>Beide Br√ºste:</strong> Automatische Erkennung von Seitenwechseln</li>
                    <li><strong>Multi-Baby Support:</strong> Mehrere Babys verwalten</li>
                    <li><strong>Tages-Statistiken:</strong> Durchschnitte</li>
                    <li><strong>Intelligente Gruppierung:</strong> Sessions < 10 Min werden kombiniert</li>
                    <li><strong>CSV Export/Import:</strong> Daten sichern und √ºbertragen</li>
                </ul>

                <h2>üåê Installation</h2>
                <p>Die App kann als <strong>Progressive Web App (PWA)</strong> installiert werden:</p>
                <ol>
                    <li>Chrome √∂ffnen und zur App navigieren</li>
                    <li>Drei Punkte ‚Üí "Zum Startbildschirm hinzuf√ºgen"</li>
                    <li>App erscheint wie eine native App auf dem Homescreen</li>
                </ol>

                <h2>üí° Tipps</h2>
                <ul>
                    <li>Exportieren Sie w√∂chentlich ein Backup</li>
                    <li>Nutzen Sie aussagekr√§ftige Baby-Namen</li>
                    <li>Die "Zuletzt angelegt" Info hilft beim Seitenwechsel</li>
                    <li>Tages-Statistiken zeigen Entwicklung der Stillgewohnheiten</li>
                </ul>

                <h2>üÜì Open Source</h2>
                <p>Diese App ist kostenlos und werbefrei. Der Quellcode ist verf√ºgbar und kann frei verwendet werden.</p>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closeReadme()">Schlie√üen</button>
            </div>
        </div>
    </div>

    <script type="module">
        // App State
        let currentSession = null;
        let sessions = [];
        let babies = ['Baby'];
        let currentBaby = 'Baby';
        let currentTimer = null;
        let combinedSessionsCache = [];

        // Initialize app
        window.addEventListener('load', async () => {
            loadLocalData();
            updateUI();
            setInterval(updateUI, 60000);
        });

        // Lokale Daten laden
        function loadLocalData() {
            try {
                const savedSessions = localStorage.getItem('breastfeedingSessions');
                if (savedSessions) {
                    const parsedSessions = JSON.parse(savedSessions);
                    sessions = parsedSessions.map(session => ({
                        ...session,
                        startTime: new Date(session.startTime),
                        endTime: new Date(session.endTime)
                    }));
                }

                const savedBabies = localStorage.getItem('babies');
                if (savedBabies) {
                    babies = JSON.parse(savedBabies);
                }

                const savedCurrentBaby = localStorage.getItem('currentBaby');
                if (savedCurrentBaby) {
                    currentBaby = savedCurrentBaby;
                }
            } catch (error) {
                sessions = [];
                babies = ['Baby'];
                currentBaby = 'Baby';
            }

            updateBabySelect();
        }

        // Baby Modal
        window.openBabyModal = () => {
            document.getElementById('babyNameInput').value = '';
            document.getElementById('babyModal').style.display = 'block';
        };

        window.closeBabyModal = () => {
            document.getElementById('babyModal').style.display = 'none';
        };

        window.addBaby = () => {
            const name = document.getElementById('babyNameInput').value.trim();
            if (!name) {
                showError('Bitte einen Namen eingeben');
                return;
            }

            if (babies.includes(name)) {
                showError('Dieses Baby existiert bereits');
                return;
            }

            babies.push(name);
            try {
                localStorage.setItem('babies', JSON.stringify(babies));
            } catch (error) {
                // Silent fail
            }
            updateBabySelect();
            closeBabyModal();
        };

        window.switchBaby = () => {
            currentBaby = document.getElementById('babySelect').value;
            try {
                localStorage.setItem('currentBaby', currentBaby);
            } catch (error) {
                // Silent fail
            }
            updateUI();
        };

        // Baby umbenennen Funktionen
        window.openRenameBabyModal = () => {
            document.getElementById('currentBabyName').textContent = currentBaby;
            document.getElementById('newBabyNameInput').value = currentBaby;
            document.getElementById('renameBabyModal').style.display = 'block';
        };

        window.closeRenameBabyModal = () => {
            document.getElementById('renameBabyModal').style.display = 'none';
        };

        window.renameBaby = () => {
            const newName = document.getElementById('newBabyNameInput').value.trim();
            if (!newName) {
                showError('Bitte einen Namen eingeben');
                return;
            }

            if (babies.includes(newName) && newName !== currentBaby) {
                showError('Ein Baby mit diesem Namen existiert bereits');
                return;
            }

            const oldName = currentBaby;
            
            // Baby-Name in der Liste aktualisieren
            const babyIndex = babies.indexOf(oldName);
            if (babyIndex !== -1) {
                babies[babyIndex] = newName;
            }
            
            // Alle Sessions des Babys umbenennen
            sessions.forEach(session => {
                if (session.baby === oldName) {
                    session.baby = newName;
                }
            });
            
            // Aktuelles Baby aktualisieren
            currentBaby = newName;
            
            // Speichern
            try {
                const sessionsToSave = sessions.map(session => ({
                    ...session,
                    startTime: session.startTime.toISOString(),
                    endTime: session.endTime.toISOString()
                }));
                localStorage.setItem('breastfeedingSessions', JSON.stringify(sessionsToSave));
                localStorage.setItem('babies', JSON.stringify(babies));
                localStorage.setItem('currentBaby', currentBaby);
            } catch (error) {
                // Silent fail
            }
            
            updateBabySelect();
            updateUI();
            closeRenameBabyModal();
        };

        // Baby l√∂schen Funktionen
        window.confirmDeleteBaby = () => {
            document.getElementById('deleteBabyName').textContent = currentBaby;
            document.getElementById('deleteConfirmModal').style.display = 'block';
        };

        window.closeDeleteConfirmModal = () => {
            document.getElementById('deleteConfirmModal').style.display = 'none';
        };

        window.deleteBaby = () => {
            const babyToDelete = currentBaby;
            
            sessions = sessions.filter(session => session.baby !== babyToDelete);
            babies = babies.filter(baby => baby !== babyToDelete);
            
            if (babies.length === 0) {
                babies = ['Baby'];
                currentBaby = 'Baby';
            } else {
                currentBaby = babies[0];
            }
            
            try {
                const sessionsToSave = sessions.map(session => ({
                    ...session,
                    startTime: session.startTime.toISOString(),
                    endTime: session.endTime.toISOString()
                }));
                localStorage.setItem('breastfeedingSessions', JSON.stringify(sessionsToSave));
                localStorage.setItem('babies', JSON.stringify(babies));
                localStorage.setItem('currentBaby', currentBaby);
            } catch (error) {
                // Silent fail
            }
            
            updateBabySelect();
            updateUI();
            closeDeleteConfirmModal();
        };

        // Stillzeiten-Tracking
        window.toggleBreastfeeding = (breast) => {
            if (currentSession && currentSession.breast === breast) {
                stopBreastfeeding();
            } else if (!currentSession) {
                startBreastfeeding(breast);
            }
        };

        function startBreastfeeding(breast) {
            currentSession = {
                baby: currentBaby,
                breast: breast,
                startTime: new Date(),
                endTime: null
            };

            currentTimer = setInterval(updateCurrentSessionDisplay, 1000);
            updateUI();
        }

        async function stopBreastfeeding() {
            if (!currentSession) return;

            currentSession.endTime = new Date();
            sessions.unshift({...currentSession});
            
            try {
                const sessionsToSave = sessions.map(session => ({
                    ...session,
                    startTime: session.startTime.toISOString(),
                    endTime: session.endTime.toISOString()
                }));
                localStorage.setItem('breastfeedingSessions', JSON.stringify(sessionsToSave));
            } catch (error) {
                // Silent fail
            }

            currentSession = null;
            if (currentTimer) {
                clearInterval(currentTimer);
                currentTimer = null;
            }
            
            updateUI();
        }

        // UI Updates
        function updateUI() {
            updateBreastButtons();
            updateCurrentSessionDisplay();
            updateSessionsList();
        }

        function updateBreastButtons() {
            const leftBtn = document.getElementById('leftBreastBtn');
            const rightBtn = document.getElementById('rightBreastBtn');

            if (currentSession) {
                if (currentSession.breast === 'left') {
                    leftBtn.textContent = 'Stop';
                    leftBtn.classList.add('active');
                    rightBtn.disabled = true;
                } else {
                    rightBtn.textContent = 'Stop';
                    rightBtn.classList.add('active');  
                    leftBtn.disabled = true;
                }
            } else {
                leftBtn.textContent = 'Linke Brust';
                rightBtn.textContent = 'Rechte Brust';
                leftBtn.classList.remove('active');
                rightBtn.classList.remove('active');
                leftBtn.disabled = false;
                rightBtn.disabled = false;
            }
        }

        function updateCurrentSessionDisplay() {
            const container = document.getElementById('currentSession');
            
            if (currentSession) {
                const duration = Math.floor((new Date() - currentSession.startTime) / 1000);
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;
                
                // Bestimme die CSS-Klasse basierend auf der aktuellen Brust
                const breastClass = currentSession.breast === 'left' ? 'left-breast' : 'right-breast';
                
                container.innerHTML = `
                    <div class="current-session ${breastClass}">
                        <div class="current-session-time">${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}</div>
                        <div>${currentSession.breast === 'left' ? 'Linke Brust' : 'Rechte Brust'} ‚Ä¢ ${currentSession.baby}</div>
                    </div>
                `;
            } else {
                container.innerHTML = '';
            }
        }

        function updateSessionsList() {
            const container = document.getElementById('sessionsList');
            
            if (sessions.length === 0) {
                container.innerHTML = `<div class="empty-state">Noch keine Stillzeiten erfasst</div>`;
                return;
            }

            const filteredSessions = sessions.filter(session => session.baby === currentBaby);
            
            if (filteredSessions.length === 0) {
                container.innerHTML = `<div class="empty-state">Keine Stillzeiten f√ºr ${currentBaby} erfasst</div>`;
                return;
            }

            const sortedSessions = [...filteredSessions].sort((a, b) => b.startTime - a.startTime);
            
            let lastBreastInfo = '';
            if (sortedSessions.length > 0) {
                const mostRecentSession = sortedSessions[0];
                const lastBreast = mostRecentSession.breast === 'left' ? 'Links' : 'Rechts';
                const breastClass = mostRecentSession.breast === 'left' ? 'left' : 'right';
                
                const now = new Date();
                const timeSince = (now - mostRecentSession.endTime) / 1000 / 60;
                
                let timeText = '';
                if (timeSince < 1) {
                    timeText = ', gerade eben';
                } else if (timeSince < 60) {
                    const minutes = Math.floor(timeSince);
                    timeText = `, vor ${minutes}min`;
                } else if (timeSince < 1440) {
                    const hours = Math.floor(timeSince / 60);
                    const minutes = Math.floor(timeSince % 60);
                    if (minutes === 0) {
                        timeText = `, vor ${hours}h`;
                    } else {
                        timeText = `, vor ${hours}h ${minutes}min`;
                    }
                } else {
                    const days = Math.floor(timeSince / 1440);
                    const hours = Math.floor((timeSince % 1440) / 60);
                    if (hours === 0) {
                        timeText = `, vor ${days} Tag${days > 1 ? 'en' : ''}`;
                    } else {
                        timeText = `, vor ${days} Tag${days > 1 ? 'en' : ''} ${hours}h`;
                    }
                }
                
                lastBreastInfo = `<div class="last-breast-info ${breastClass}">Zuletzt angelegt: ${lastBreast}${timeText}</div>`;
            }
            
            const combinedSessions = [];
            const processedIndices = new Set();
            
            for (let i = 0; i < sortedSessions.length; i++) {
                if (processedIndices.has(i)) continue;
                
                const session = sortedSessions[i];
                let combinedSession = {
                    sessions: [session],
                    baby: session.baby,
                    startTime: session.startTime,
                    endTime: session.endTime,
                    breasts: [session.breast]
                };

                for (let j = 0; j < sortedSessions.length; j++) {
                    if (i === j || processedIndices.has(j)) continue;
                    
                    const otherSession = sortedSessions[j];
                    
                    const timeDiffStart = Math.abs(combinedSession.startTime - otherSession.endTime) / 1000 / 60;
                    const timeDiffEnd = Math.abs(combinedSession.endTime - otherSession.startTime) / 1000 / 60;
                    const minTimeDiff = Math.min(timeDiffStart, timeDiffEnd);
                    
                    if (minTimeDiff < 10) {
                        combinedSession.sessions.push(otherSession);
                        combinedSession.breasts.push(otherSession.breast);
                        combinedSession.startTime = new Date(Math.min(combinedSession.startTime, otherSession.startTime));
                        combinedSession.endTime = new Date(Math.max(combinedSession.endTime, otherSession.endTime));
                        
                        processedIndices.add(j);
                    }
                }
                
                processedIndices.add(i);
                combinedSessions.push(combinedSession);
            }
            
            combinedSessions.sort((a, b) => b.startTime - a.startTime);
            
            // Cache f√ºr Session-Modals
            combinedSessionsCache = combinedSessions;

            let sessionsHtml = '';
            let currentDay = null;
            
            for (let i = 0; i < combinedSessions.length; i++) {
                const combinedSession = combinedSessions[i];
                const sessionDate = combinedSession.startTime.toLocaleDateString('de-DE');
                
                if (currentDay !== sessionDate) {
                    const dayCombinedSessions = combinedSessions.filter(session => 
                        session.startTime.toLocaleDateString('de-DE') === sessionDate
                    );
                    
                    const daySessionsCount = dayCombinedSessions.length;
                    
                    const totalDayDuration = dayCombinedSessions.reduce((sum, combinedSession) => {
                        const sessionSum = combinedSession.sessions.reduce((sessionTotal, session) => 
                            sessionTotal + Math.floor((session.endTime - session.startTime) / 1000 / 60), 0
                        );
                        return sum + sessionSum;
                    }, 0);
                    
                    const avgDuration = Math.round(totalDayDuration / daySessionsCount);
                    
                    let avgInterval = 0;
                    
                    if (dayCombinedSessions.length > 1) {
                        const sortedDaySessions = [...dayCombinedSessions].sort((a, b) => a.startTime - b.startTime);
                        let totalIntervals = 0;
                        let intervalCount = 0;
                        
                        for (let j = 0; j < sortedDaySessions.length - 1; j++) {
                            const currentSessionEnd = sortedDaySessions[j].endTime;
                            const nextSessionStart = sortedDaySessions[j + 1].startTime;
                            const intervalMinutes = (nextSessionStart - currentSessionEnd) / 1000 / 60;
                            
                            if (intervalMinutes > 0) {
                                totalIntervals += intervalMinutes;
                                intervalCount++;
                            }
                        }
                        
                        if (intervalCount > 0) {
                            avgInterval = Math.round(totalIntervals / intervalCount);
                        }
                    }
                    
                    const dayName = new Date(combinedSession.startTime).toLocaleDateString('de-DE', {
                        weekday: 'long',
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                    
                    function formatInterval(minutes) {
                        if (minutes >= 60) {
                            const hours = Math.floor(minutes / 60);
                            const mins = minutes % 60;
                            if (mins === 0) {
                                return `${hours}h`;
                            } else {
                                return `${hours}h ${mins}min`;
                            }
                        } else {
                            return `${minutes}min`;
                        }
                    }
                    
                    let intervalText = '';
                    if (avgInterval > 0) {
                        intervalText = ` ‚Ä¢ ‚åÄ ${formatInterval(avgInterval)} Abstand`;
                    }
                    
                    sessionsHtml += `
                        <div class="day-summary">
                            <div class="day-summary-date">${dayName}</div>
                            <div class="day-summary-stats">${daySessionsCount} Stillzeiten ‚Ä¢ ‚åÄ ${avgDuration} Min${intervalText}</div>
                        </div>
                    `;
                    
                    currentDay = sessionDate;
                }
                
                const duration = combinedSession.sessions.reduce((total, session) => 
                    total + Math.floor((session.endTime - session.startTime) / 1000 / 60), 0
                );
                
                const startTime = combinedSession.startTime.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
                const endTime = combinedSession.endTime.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
                const date = combinedSession.startTime.toLocaleDateString('de-DE');
                
                const orderedSessions = combinedSession.sessions.sort((a, b) => a.startTime - b.startTime);
                
                const uniqueBreasts = [...new Set(combinedSession.breasts)];
                let breastText;
                let durationDetails = '';
                
                if (uniqueBreasts.length === 2) {
                    breastText = 'Beide Br√ºste';
                } else if (uniqueBreasts[0] === 'left') {
                    breastText = 'Linke Brust';
                } else {
                    breastText = 'Rechte Brust';
                }
                
                if (combinedSession.sessions.length > 1) {
                    breastText += ` (${combinedSession.sessions.length} Phasen)`;
                    
                    const phaseDurations = orderedSessions.map(session => {
                        const phaseDuration = Math.floor((session.endTime - session.startTime) / 1000 / 60);
                        const breastName = session.breast === 'left' ? 'L' : 'R';
                        return `${breastName}: ${phaseDuration}min`;
                    });
                    
                    durationDetails = `<div class="session-phases" style="color: #666; font-size: 12px; margin-top: 5px;">${phaseDurations.join(' ‚Üí ')}</div>`;
                }

                let timeBetweenText = '';
                if (i < combinedSessions.length - 1) {
                    const nextSession = combinedSessions[i + 1];
                    const nextSessionDate = nextSession.startTime.toLocaleDateString('de-DE');
                    
                    if (sessionDate === nextSessionDate) {
                        const timeBetween = (combinedSession.startTime - nextSession.endTime) / 1000 / 60 / 60;
                        
                        if (timeBetween > 0) {
                            if (timeBetween >= 1) {
                                const hours = Math.floor(timeBetween);
                                const minutes = Math.round((timeBetween - hours) * 60);
                                if (minutes === 0) {
                                    timeBetweenText = `<div style="text-align: center; color: #666; font-size: 12px; margin: 10px 0; font-weight: bold;">‚Üì ${hours}h sp√§ter ‚Üì</div>`;
                                } else {
                                    timeBetweenText = `<div style="text-align: center; color: #666; font-size: 12px; margin: 10px 0; font-weight: bold;">‚Üì ${hours}h ${minutes}min sp√§ter ‚Üì</div>`;
                                }
                            } else {
                                const minutes = Math.round(timeBetween * 60);
                                timeBetweenText = `<div style="text-align: center; color: #666; font-size: 12px; margin: 10px 0; font-weight: bold;">‚Üì ${minutes}min sp√§ter ‚Üì</div>`;
                            }
                        }
                    }
                }
                
                let sessionClass = '';
                if (uniqueBreasts.length === 2) {
                    sessionClass = 'both-breasts';
                } else if (uniqueBreasts.includes('right')) {
                    sessionClass = 'right-breast';
                }
                
                sessionsHtml += `
                    <div class="session-entry ${sessionClass}" onclick="openSessionModal(${i})">
                        <div class="session-date">
                            ${breastText} ‚Ä¢ ${combinedSession.baby}
                        </div>
                        <div class="session-time">${date} ‚Ä¢ ${startTime} - ${endTime}</div>
                        <div class="session-duration">${duration} Minuten gesamt</div>
                        ${durationDetails}
                    </div>
                    ${timeBetweenText}
                `;
            }

            container.innerHTML = lastBreastInfo + sessionsHtml;
        }

        function updateBabySelect() {
            const select = document.getElementById('babySelect');
            select.innerHTML = babies.map(baby => 
                `<option value="${baby}" ${baby === currentBaby ? 'selected' : ''}>${baby}</option>`
            ).join('');
        }

        // CSV Export/Import
        window.exportToCSV = () => {
            if (sessions.length === 0) {
                showError('Keine Daten zum Exportieren vorhanden');
                return;
            }

            const headers = ['Baby', 'Brust', 'Startdatum', 'Startzeit', 'Enddatum', 'Endzeit', 'Dauer (Minuten)'];
            
            const rows = sessions.map(session => {
                const duration = Math.floor((session.endTime - session.startTime) / 1000 / 60);
                const startDate = session.startTime.toLocaleDateString('de-DE');
                const startTime = session.startTime.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
                const endDate = session.endTime.toLocaleDateString('de-DE');
                const endTime = session.endTime.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
                const breast = session.breast === 'left' ? 'Links' : 'Rechts';
                
                return [session.baby, breast, startDate, startTime, endDate, endTime, duration];
            });

            const csvContent = [headers, ...rows]
                .map(row => row.map(field => `"${field}"`).join(','))
                .join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `stillzeiten_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccess(`${sessions.length} Stillzeiten erfolgreich als CSV exportiert!`);
        };

        window.importFromCSV = async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const lines = text.split('\n').filter(line => line.trim());
                
                if (lines.length < 2) {
                    showError('CSV-Datei ist leer oder ung√ºltig');
                    return;
                }

                const headerLine = lines[0];
                const headers = headerLine.split(',').map(field => 
                    field.replace(/^"/, '').replace(/"$/, '').trim().toLowerCase()
                );

                const babyIndex = headers.findIndex(h => h.includes('baby'));
                const breastIndex = headers.findIndex(h => h.includes('brust') || h.includes('breast'));
                const startDateIndex = headers.findIndex(h => h.includes('startdatum') || h.includes('start') && h.includes('datum'));
                const startTimeIndex = headers.findIndex(h => h.includes('startzeit') || h.includes('start') && h.includes('zeit'));
                const endDateIndex = headers.findIndex(h => h.includes('enddatum') || h.includes('end') && h.includes('datum'));
                const endTimeIndex = headers.findIndex(h => h.includes('endzeit') || h.includes('end') && h.includes('zeit'));

                if (babyIndex === -1 || breastIndex === -1 || startDateIndex === -1 || startTimeIndex === -1) {
                    showError('CSV-Format ung√ºltig. Ben√∂tigte Spalten: Baby, Brust, Startdatum, Startzeit');
                    return;
                }

                const dataLines = lines.slice(1);
                const importedSessions = [];
                const importedBabies = new Set(babies);
                let errorsCount = 0;

                for (let i = 0; i < dataLines.length; i++) {
                    const line = dataLines[i];
                    
                    const fields = line.split(',').map(field => 
                        field.replace(/^"/, '').replace(/"$/, '').trim()
                    );

                    try {
                        const baby = fields[babyIndex] || 'Baby';
                        const breastRaw = fields[breastIndex] || '';
                        const breast = breastRaw.toLowerCase().includes('links') || breastRaw.toLowerCase().includes('left') ? 'left' : 'right';
                        const startDate = fields[startDateIndex] || '';
                        const startTime = fields[startTimeIndex] || '';

                        if (!startDate || !startTime) {
                            errorsCount++;
                            continue;
                        }

                        let startDateTime;
                        
                        // Deutsches Datumsformat DD.MM.YYYY explizit parsen
                        if (startDate.includes('.')) {
                            const [day, month, year] = startDate.split('.');
                            const isoDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                            startDateTime = new Date(`${isoDate} ${startTime}`);
                        } else {
                            // Fallback f√ºr andere Formate
                            const startDateTimeCombinations = [
                                `${startDate} ${startTime}`,
                                `${startDate.split('.').reverse().join('-')} ${startTime}`,
                                startDate.includes('T') ? startDate : null
                            ].filter(Boolean);

                            for (const combination of startDateTimeCombinations) {
                                startDateTime = new Date(combination);
                                if (!isNaN(startDateTime.getTime())) break;
                            }
                        }

                        if (!startDateTime || isNaN(startDateTime.getTime())) {
                            errorsCount++;
                            continue;
                        }

                        let endDateTime = null;
                        
                        if (endDateIndex !== -1 && endTimeIndex !== -1 && 
                            fields[endDateIndex] && fields[endTimeIndex]) {
                            
                            const endDate = fields[endDateIndex];
                            const endTime = fields[endTimeIndex];

                            // Deutsches Datumsformat DD.MM.YYYY explizit parsen
                            if (endDate.includes('.')) {
                                const [day, month, year] = endDate.split('.');
                                const isoDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                                endDateTime = new Date(`${isoDate} ${endTime}`);
                            } else {
                                // Fallback f√ºr andere Formate
                                const endDateTimeCombinations = [
                                    `${endDate} ${endTime}`,
                                    `${endDate.split('.').reverse().join('-')} ${endTime}`,
                                    endDate.includes('T') ? endDate : null
                                ].filter(Boolean);

                                for (const combination of endDateTimeCombinations) {
                                    endDateTime = new Date(combination);
                                    if (!isNaN(endDateTime.getTime())) break;
                                }
                            }
                        }

                        if (!endDateTime || isNaN(endDateTime.getTime())) {
                            endDateTime = new Date(startDateTime.getTime() + 15 * 60 * 1000);
                        }

                        if (endDateTime <= startDateTime) {
                            endDateTime = new Date(startDateTime.getTime() + 15 * 60 * 1000);
                        }

                        const session = {
                            baby,
                            breast,
                            startTime: startDateTime,
                            endTime: endDateTime
                        };

                        importedSessions.push(session);
                        importedBabies.add(baby);

                    } catch (error) {
                        errorsCount++;
                    }
                }

                if (importedSessions.length === 0) {
                    showError(`Keine g√ºltigen Daten importiert. ${errorsCount} Zeilen enthielten Fehler.`);
                    return;
                }

                const existingSessionsCount = sessions.length;
                importedSessions.forEach(importedSession => {
                    const exists = sessions.some(session => 
                        Math.abs(session.startTime - importedSession.startTime) < 60000 &&
                        session.breast === importedSession.breast &&
                        session.baby === importedSession.baby
                    );
                    
                    if (!exists) {
                        sessions.push(importedSession);
                    }
                });

                sessions.sort((a, b) => b.startTime - a.startTime);
                babies = Array.from(importedBabies);
                
                try {
                    const sessionsToSave = sessions.map(session => ({
                        ...session,
                        startTime: session.startTime.toISOString(),
                        endTime: session.endTime.toISOString()
                    }));
                    localStorage.setItem('breastfeedingSessions', JSON.stringify(sessionsToSave));
                    localStorage.setItem('babies', JSON.stringify(babies));
                } catch (error) {
                    // Silent fail
                }

                updateBabySelect();
                updateUI();

                const newSessionsCount = sessions.length - existingSessionsCount;
                let message = `${newSessionsCount} neue Stillzeiten erfolgreich importiert!\nInsgesamt: ${sessions.length} Eintr√§ge`;
                
                if (errorsCount > 0) {
                    message += `\n${errorsCount} Zeilen konnten nicht importiert werden`;
                }

                showSuccess(message);

            } catch (error) {
                showError('Fehler beim Importieren der CSV-Datei. Bitte Format √ºberpr√ºfen.');
            }

            event.target.value = '';
        };

        // Readme Modal
        window.showReadme = () => {
            document.getElementById('readmeModal').style.display = 'block';
        };

        window.closeReadme = () => {
            document.getElementById('readmeModal').style.display = 'none';
        };

        // Session Modal
        window.openSessionModal = (sessionIndex) => {
            const combinedSession = combinedSessionsCache[sessionIndex];
            if (!combinedSession) return;

            const content = document.getElementById('sessionEditContent');
            let html = '';

            if (combinedSession.sessions.length === 1) {
                // Einzelne Session
                const session = combinedSession.sessions[0];
                html = createSingleSessionEditForm(session, 0, sessionIndex);
            } else {
                // Kombinierte Sessions
                html = '<h3 style="margin-bottom: 15px;">Einzelne Stillzeiten in dieser kombinierten Session:</h3>';
                combinedSession.sessions.forEach((session, index) => {
                    html += createSingleSessionEditForm(session, index, sessionIndex);
                });
            }

            content.innerHTML = html;
            document.getElementById('sessionModal').style.display = 'block';
        };

        function createSingleSessionEditForm(session, subIndex, sessionIndex) {
            const sessionId = `${sessionIndex}-${subIndex}`;
            const startDate = session.startTime.toLocaleDateString('de-DE');
            const startTime = session.startTime.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
            const endDate = session.endTime.toLocaleDateString('de-DE');
            const endTime = session.endTime.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
            
            const babyOptions = babies.map(baby => 
                `<option value="${baby}" ${baby === session.baby ? 'selected' : ''}>${baby}</option>`
            ).join('');

            return `
                <div class="single-session-edit">
                    <div class="single-session-header">
                        ${session.breast === 'left' ? 'Linke Brust' : 'Rechte Brust'} ‚Ä¢ ${session.baby}
                    </div>
                    <div class="single-session-delete">
                        <button class="btn btn-danger btn-small" onclick="deleteSessionConfirm('${sessionId}')">üóëÔ∏è L√∂schen</button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Baby:</label>
                            <select id="baby-${sessionId}">
                                ${babyOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Brust:</label>
                            <select id="breast-${sessionId}">
                                <option value="left" ${session.breast === 'left' ? 'selected' : ''}>Links</option>
                                <option value="right" ${session.breast === 'right' ? 'selected' : ''}>Rechts</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Startdatum:</label>
                            <input type="date" id="startDate-${sessionId}" value="${session.startTime.toISOString().split('T')[0]}">
                        </div>
                        <div class="form-group">
                            <label>Startzeit:</label>
                            <input type="time" id="startTime-${sessionId}" value="${startTime}">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Enddatum:</label>
                            <input type="date" id="endDate-${sessionId}" value="${session.endTime.toISOString().split('T')[0]}">
                        </div>
                        <div class="form-group">
                            <label>Endzeit:</label>
                            <input type="time" id="endTime-${sessionId}" value="${endTime}">
                        </div>
                    </div>
                </div>
            `;
        }

        window.closeSessionModal = () => {
            document.getElementById('sessionModal').style.display = 'none';
        };

        window.deleteSessionConfirm = (sessionId) => {
            currentSessionToDelete = sessionId;
            document.getElementById('deleteSessionButton').onclick = () => {
                deleteSession(currentSessionToDelete);
                closeDeleteSessionModal();
            };
            document.getElementById('deleteSessionModal').style.display = 'block';
        };

        function deleteSession(sessionId) {
            const [sessionIndex, subIndex] = sessionId.split('-').map(Number);
            const combinedSession = combinedSessionsCache[sessionIndex];
            const sessionToDelete = combinedSession.sessions[subIndex];

            // Session aus der Hauptliste entfernen
            const sessionIndexInMain = sessions.findIndex(s => 
                Math.abs(s.startTime - sessionToDelete.startTime) < 1000 &&
                s.breast === sessionToDelete.breast &&
                s.baby === sessionToDelete.baby
            );

            if (sessionIndexInMain !== -1) {
                sessions.splice(sessionIndexInMain, 1);
            }

            // Speichern
            try {
                const sessionsToSave = sessions.map(session => ({
                    ...session,
                    startTime: session.startTime.toISOString(),
                    endTime: session.endTime.toISOString()
                }));
                localStorage.setItem('breastfeedingSessions', JSON.stringify(sessionsToSave));
            } catch (error) {
                // Silent fail
            }

            updateUI();
            closeSessionModal();
        }

        window.saveSessionChanges = () => {
            const editForms = document.querySelectorAll('.single-session-edit');
            let hasChanges = false;

            editForms.forEach((form, index) => {
                const sessionIdElements = form.querySelectorAll('[id]');
                if (sessionIdElements.length === 0) return;

                const sessionId = sessionIdElements[0].id.split('-').slice(1).join('-');
                const [sessionIndex, subIndex] = sessionId.split('-').map(Number);
                const combinedSession = combinedSessionsCache[sessionIndex];
                const originalSession = combinedSession.sessions[subIndex];

                // Neue Werte sammeln
                const baby = document.getElementById(`baby-${sessionId}`).value;
                const breast = document.getElementById(`breast-${sessionId}`).value;
                const startDate = document.getElementById(`startDate-${sessionId}`).value;
                const startTime = document.getElementById(`startTime-${sessionId}`).value;
                const endDate = document.getElementById(`endDate-${sessionId}`).value;
                const endTime = document.getElementById(`endTime-${sessionId}`).value;

                const newStartTime = new Date(`${startDate}T${startTime}`);
                const newEndTime = new Date(`${endDate}T${endTime}`);

                // Validierung
                if (newStartTime >= newEndTime) {
                    showError('Endzeit muss nach der Startzeit liegen!');
                    return;
                }

                // Session in der Hauptliste finden und aktualisieren
                const sessionIndexInMain = sessions.findIndex(s => 
                    Math.abs(s.startTime - originalSession.startTime) < 1000 &&
                    s.breast === originalSession.breast &&
                    s.baby === originalSession.baby
                );

                if (sessionIndexInMain !== -1) {
                    sessions[sessionIndexInMain] = {
                        ...sessions[sessionIndexInMain],
                        baby,
                        breast,
                        startTime: newStartTime,
                        endTime: newEndTime
                    };
                    hasChanges = true;
                }
            });

            if (hasChanges) {
                // Sortieren nach Datum
                sessions.sort((a, b) => b.startTime - a.startTime);

                // Speichern
                try {
                    const sessionsToSave = sessions.map(session => ({
                        ...session,
                        startTime: session.startTime.toISOString(),
                        endTime: session.endTime.toISOString()
                    }));
                    localStorage.setItem('breastfeedingSessions', JSON.stringify(sessionsToSave));
                } catch (error) {
                    // Silent fail
                }

                updateUI();
            }

            closeSessionModal();
        };

        // Modal close on outside click
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Allgemeine Modal-Funktionen
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorModal').style.display = 'block';
        }

        window.closeErrorModal = () => {
            document.getElementById('errorModal').style.display = 'none';
        };

        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successModal').style.display = 'block';
        }

        window.closeSuccessModal = () => {
            document.getElementById('successModal').style.display = 'none';
        };

        function showConfirm(message, onConfirm) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmButton').onclick = () => {
                closeConfirmModal();
                onConfirm();
            };
            document.getElementById('confirmModal').style.display = 'block';
        }

        window.closeConfirmModal = () => {
            document.getElementById('confirmModal').style.display = 'none';
        };

        let currentSessionToDelete = null;

        window.closeDeleteSessionModal = () => {
            document.getElementById('deleteSessionModal').style.display = 'none';
            currentSessionToDelete = null;
        };
    </script>
</body>
</html>
